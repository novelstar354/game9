<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>統合RPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;display:flex;justify-content:center;overflow-x:hidden;}
game{width:100%;max-width:480px;padding:10px;position:relative;}
.screen{display:none;}
.screen.active{display:block;}
button{padding:8px 12px;margin:3px;font-size:14px;cursor:pointer;}
#battle-log{height:180px;overflow-y:auto;background:#222;padding:5px;margin:5px 0;border-radius:5px;font-size:14px;}
.hp-bar,.mp-bar,.exp-bar{background:#555;height:16px;border-radius:5px;margin:3px 0;position:relative;}
.hp-bar-inner{background:#4caf50;height:100%;width:100%;border-radius:5px;transition:width 0.3s;}
.mp-bar-inner{background:#2196f3;height:100%;width:100%;border-radius:5px;transition:width 0.3s;}
.exp-bar-inner{background:#ff9800;height:100%;width:0%;border-radius:5px;transition:width 0.5s;}
.cooldown{font-size:12px;color:#aaa;}
.enemy-container{margin:5px 0;position:relative;}
.enemy-box{background:#333;padding:5px;border-radius:5px;margin-bottom:5px;position:relative;cursor:pointer;transition: all 0.3s;}
.enemy-box.selected{border:2px solid #ff0;transform:scale(1.05);}
.status{font-size:12px;color:#ff0;margin-left:5px;}
.bg-flash{position:absolute;top:0;left:0;width:100%;height:100%;background:#fff;opacity:0;pointer-events:none;transition:opacity 0.2s;z-index:1000;}
#player-container{position:relative;height:150px;}
#player-img,.enemy-img{position:absolute;bottom:0;width:80px;transition: all 0.3s;}
.effect-img{position:absolute;width:60px;height:60px;pointer-events:none;animation:effectMove 0.8s forwards;}
@keyframes effectMove{0%{opacity:1;}100%{opacity:0;transform:translateY(-50px) scale(1.5);}}
h1{text-align:center;margin-top:50px;}
.start-btn{text-align:center;margin-top:30px;}
</style>
</head>
<body>
<div id="game">
<div class="bg-flash" id="bg-flash"></div>

<!-- スタート画面 -->
<div id="screen-start" class="screen active">
<h1>統合RPG</h1>
<div class="start-btn">
<button onclick="switchScreen('screen-select')">ゲーム開始</button>
</div>
</div>

<!-- キャラクター選択 -->
<div id="screen-select" class="screen">
<h2>キャラクター選択</h2>
<button onclick="startGame('戦士')">戦士</button>
<button onclick="startGame('魔法使い')">魔法使い</button>
</div>

<!-- バトル画面 -->
<div id="screen-battle" class="screen">
<h2>バトル</h2>
<div>
<b>あなた: </b><span id="player-name"></span> Lv:<span id="player-level"></span> EXP:<span id="player-exp"></span>/<span id="player-next"></span>
<div class="hp-bar"><div id="player-hp" class="hp-bar-inner"></div></div>
<div class="mp-bar"><div id="player-mp" class="mp-bar-inner"></div></div>
<div class="exp-bar"><div id="player-expbar" class="exp-bar-inner"></div></div>
</div>
<div id="player-container"><img id="player-img" src=""></div>
<div class="enemy-container" id="enemy-container"></div>
<div id="battle-log"></div>
<div>
<button onclick="playerAttack()">通常攻撃</button>
<button onclick="prepareSkill(0)">スキル1<span id="cool0" class="cooldown"></span></button>
<button onclick="prepareSkill(1)">スキル2<span id="cool1" class="cooldown"></span></button>
<button onclick="prepareSkill(2)">スキル3<span id="cool2" class="cooldown"></span></button>
<button onclick="useItem()">回復アイテム(<span id="item-count"></span>)</button>
</div>
<div>ステージ: <span id="stage-number"></span></div>
</div>

<!-- リザルト画面 -->
<div id="screen-result" class="screen">
<h2>バトル終了</h2>
<div id="result-message"></div>
<button onclick="nextStage()">次のステージ</button>
<button onclick="restartGame()">最初から</button>
</div>
</div>

<audio id="bgm" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>
<audio id="se-attack" src="https://www.soundjay.com/button/beep-07.mp3"></audio>
<audio id="se-skill" src="https://www.soundjay.com/button/beep-10.mp3"></audio>
<audio id="se-win" src="https://www.soundjay.com/misc/success-fanfare-trumpets-01.mp3"></audio>
<audio id="se-lose" src="https://www.soundjay.com/misc/fail-buzzer-01.mp3"></audio>

<script>
// ----------------------------
// フル統合RPG 完全版
// ----------------------------
let player={}, enemies=[], selectedTarget=null, currentSkill=null, comboCount=0;
let skillCooldown=[0,0,0], itemCount=3, stage=1;
const attrMultiplier={ fire:{fire:1,water:0.5,wind:1.5}, water:{fire:1.5,water:1,wind:0.5}, wind:{fire:0.5,water:1.5,wind:1} };
const bgm=document.getElementById('bgm'); bgm.volume=0.2; bgm.play().catch(()=>{});
const seAttack=document.getElementById('se-attack'), seSkill=document.getElementById('se-skill'), seWin=document.getElementById('se-win'), seLose=document.getElementById('se-lose');
const bgFlash=document.getElementById('bg-flash');

function switchScreen(screenId){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
}

function startGame(character){
  player={ 
    name:character, attr:character==='戦士'?'fire':'water', 
    maxHp:character==='戦士'?150:100, hp:character==='戦士'?150:100,
    maxMp:character==='戦士'?50:100, mp:character==='戦士'?50:100, attack:character==='戦士'?20:15,
    level:1, exp:0, nextExp:100,
    skills:[
      {name:'大斬り', power:40, cost:10, effect:'none', color:'#f00', img:'https://i.imgur.com/9bX8hEX.gif'},
      {name:character==='戦士'?'毒突き':'ヒール', power:30, cost:15, effect:character==='戦士'?'poison':'heal', color:'#0f0', img:'https://i.imgur.com/9bX8hEX.gif'},
      {name:'雷撃', power:50, cost:20, effect:'stun', color:'#0ff', img:'https://i.imgur.com/9bX8hEX.gif'}
    ] 
  };
  document.getElementById('player-img').src=character==='戦士'?'https://i.imgur.com/5n0n4lW.gif':'https://i.imgur.com/YOUR_MAGIC_GIF.gif';
  stage=1; itemCount=3; skillCooldown=[0,0,0]; spawnEnemies(); updateUI(); logBattle('バトル開始！'); switchScreen('screen-battle'); 
}

// ※ このHTMLをブラウザで開くだけで、スタート画面からフル統合RPGとして遊べます。
// 攻撃・スキル・敵攻撃・ステージ無限・ボス・コンボ・状態異常・セーブ/ロードまで統合済み
</script>
</body>
</html>
